<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Alpha Video in WebAR</title>
<style>
  body { margin: 0; overflow: hidden; background: transparent; }
  video { display: none; }
</style>
<script src="https://cdn.jsdelivr.net/npm/three@0.165.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.165.0/examples/jsm/webxr/ARButton.js"></script>
</head>
<body>

<script>
let scene, camera, renderer;

init();
function init() {
  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);

  renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.xr.enabled = true;
  document.body.appendChild(renderer.domElement);

  document.body.appendChild(ARButton.createButton(renderer, { requiredFeatures: ['hit-test'] }));

  // Create video element with alpha
  const video = document.createElement('video');
  video.autoplay = true;
  video.loop = true;
  video.muted = true;
  video.playsInline = true;

  // Detect iOS
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  if (isIOS) {
    video.src = 'assets/movie-hevc.mov'; // HEVC alpha
    video.type = 'video/mp4; codecs="hvc1"';
  } else {
    video.src = 'assets/movie-webm.webm'; // VP9 alpha
    video.type = 'video/webm; codecs="vp9"';
  }

  const texture = new THREE.VideoTexture(video);
  texture.encoding = THREE.sRGBEncoding;
  texture.format = THREE.RGBAFormat;

  const geometry = new THREE.PlaneGeometry(1, 0.5625); // 16:9 ratio
  const material = new THREE.MeshBasicMaterial({
    map: texture,
    transparent: true,
    side: THREE.DoubleSide
  });

  const mesh = new THREE.Mesh(geometry, material);
  mesh.position.set(0, 0, -2); // 2m in front
  scene.add(mesh);

  renderer.setAnimationLoop(() => {
    renderer.render(scene, camera);
  });
}
</script>

</body>
</html>
